<!-- Page styling must be fixed -->

{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Add or Modify Sensors</title>
    <link rel="icon" href="{% static 'mercury/motorsports_logo.png' %}">
    <link rel="preload" href="{% static 'mercury/technical_difficulties.jpg' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'mercury/style.css' %}">
    <script src="{% static "mercury/js/sensor.js" %}" defer></script>
</head>

<body onload="selectView();">
    {% include 'sidebar.html' %}
    <div id="grafana-base"> <!-- app default background -->
        <h1> Add or Modify Sensors </h1>

        <nav>
            <ul>
                <!-- Note that the button tag without type="button" will default into type="submit" and POST / GET in some browsers and contexts (like when used inside form) -->
                <li><button onclick="displayCurrentSensors()" type="button" id="current-sensor-btn" class="grafana-btn"> View Sensors </button></li>
                <li><button onclick="displaySensorTypes()" type= "button" id="view-sensor-types-btn" class="grafana-btn"> View Sensor Types </button></li>
                <li><button onclick="displayAddNewSensor()" type= "button" id="add-sensor-btn" class="grafana-btn"> Add New Sensor </button></li>
                <li><button onclick="displayAddNewSensorType()" type= "button" id="add-sensor-type-btn" class="grafana-btn"> Add New Sensor Type </button></li>
                <li><button onclick="displayEditSensors()" type= "button" id="edit-sensors-btn" class="grafana-btn"> Edit Existing Sensors </button></li>
                <li><button onclick="displayEditSensorTypes()" type= "button" id="edit-sensor-types-btn" class="grafana-btn"> Edit Existing Sensor Types </button></li>
            </ul>
        </nav>

        {% for message in messages %}
            <p class="error"> {{ message }} </p>
        {% endfor %}

        <div id="existing-sensors">
            <h2>Existing Sensors</h2>
            <br>
            {% if sensors %}
                {% for sensor in sensors %}
                <div class="panel">
                    <h2 contenteditable="false" id="{{ sensor.name }}">
                    {{ sensor.name }}</h2>

                    <h5 contenteditable="false" id="{{ sensor_type.id }}">
                        ID: {{ sensor.id }}
                    </h5>
                    <br>

                    <h4 class="inline-block-child"><u>Field Name</u></h4>
                    <h4 class="inline-block-child"><u>Field Type</u></h4>
                    <h4 class="inline-block-child"><u>Field Unit</u></h4>

                    {% for field_name, unit_and_format in sensor.type_id.format.items %}
                    <div>
                        <p class="inline-block-child"
                        contenteditable="false">{{field_name}}</p>
                        <p class="inline-block-child"
                        contenteditable="false">{{unit_and_format.data_type}}</p>
                        <p class="inline-block-child"
                        contenteditable="false">{{unit_and_format.unit}}</p>
                    </div>
                    {% endfor %}
                </div>
                {% endfor %}
            {% else %}
                <h3 style="color:red;"><b> There are no sensors to display </b></h3>
                <img class=center-image src="{% static 'mercury/technical_difficulties.jpg' %}">
            {% endif%}
        </div> <!-- end existing sensors -->

        <div id="add-new-sensor">
            <h2>Add a New Sensor</h2>
            <br>
            {% if sensor_types %}
                <form method="POST">
                    {% csrf_token %}
                    <div id = "sensor-container"> <!-- single div for configuring entire sensor -->
                        <div class="inline-box">
                            <label for="sensor-name"> <b>Sensor Name:</b> </label>
                            <input type="text" id="sensor-name" name="sensor-name" required/>
                                <label for="select-sensor-type"> <b>Sensor Type:</b> </label>
                                <select id="select-sensor-type" name="select-sensor-type"/>
                                {% for sensor_type in sensor_types %}
                                    <option>{{ sensor_type.name }}</option>
                                {% endfor %}
                        </select>

                    </div> <br>
                </div> <br> <!-- end new sensor container -->
                <h4>Preview</h4> <!-- TODO: need to add preview feature ---> 

                <button type="submit" name="submit_new_sensor" class="grafana-btn grafana-btn-green"> Add New Sensor </button>
            </form>
            {% else %}
                <h3 style="color:red"><b>Add a sensor type in "Add New Sensor Type" to proceed</b></h3>
                <img class=center-image src="{% static 'mercury/technical_difficulties.jpg' %}">
            {% endif%}
            <br>
        </div>

        <div id = "add-new-type">
            <h2>Add a New Sensor Type</h2>
            <form method="POST">
                {% csrf_token %}
                <div id = "type-container"> <!-- single div for configuring entire sensor type -->
                    <div class="inline-box">
                        <label for="type-name"> <b>Type Name:</b> </label>
                        <input type="text" id="type-name" name="type-name" required/>
                    </div> <br>

                    <table id="new-type-table">
                        <thead>
                            <tr>
                                <th><b> Field Number </b></th>
                                <th><b> Field Name </b></th>
                                <th><b> Field Data Type </b></th>
                                <th><b> Unit </b> (optional) </th>
                            </tr>
                        </thead>

                        <tbody>
                            <tr>
                                <td> 1 </td>

                                <td> <input type="text" id="field-name" name="field-names" required/> </td>

                                <td>
                                    <select id="data-type" name="data-types"/>
                                        <option> Numeric </option>
                                        <option> Character </option>
                                        <option> Boolean </option>
                                    </select>
                                </td>

                                <td> <input type="text" id="unit" name="units"/> </td>
                            </tr>
                        </tbody>
                    </table> <br>

                    <div class="inline-box">
                        <button type="button" onclick="addRow()" class="grafana-btn grafana-btn-gray"> Add Another Sensor Field </button>
                        <button type="button" onclick="deleteRow()" class="grafana-btn grafana-btn-red"> Delete Last Sensor Field </button> <br><br>
                    </div>

                </div> <br> <!-- end new sensor type container -->

                <button type="submit" name="submit_new_type" class="grafana-btn grafana-btn-green"> Add New Sensor Type </button>
            </form>
            <br>

        </div> <!-- end add new type -->

        <div id="view-existing-types">
            <h2>Existing Types</h2>
            <br>
            {% if sensor_types %}
                {% for sensor_type in sensor_types %}
                <div class="panel">
                    <h2 contenteditable="false" id="{{ sensor_type.type_name }}">
                    {{ sensor_type.name }}</h2>

                    <h5 contenteditable="false" id="{{ sensor_type.id }}">
                        ID: {{ sensor_type.id }}
                    </h5>
                    <br>

                    <h4 class="inline-block-child"><u>Field Name</u></h4>
                    <h4 class="inline-block-child"><u>Field Type</u></h4>
                    <h4 class="inline-block-child"><u>Field Unit</u></h4>

                    {% for field_name, unit_and_format in sensor_type.format.items %}
                    <div>
                        <p class="inline-block-child"
                        contenteditable="false">{{field_name}}</p>
                        <p class="inline-block-child"
                        contenteditable="false">{{unit_and_format.data_type}}</p>
                        <p class="inline-block-child"
                        contenteditable="false">{{unit_and_format.unit}}</p>
                    </div>
                    {% endfor %}
                </div>
                {% endfor %}
            {% else %}
                <h3 style="color:red;"><b> There are no types to display </b></h3>
                <img class=center-image src="{% static 'mercury/technical_difficulties.jpg' %}">
            {% endif%}

        </div> <!-- end view existing types -->

        <div id="edit-sensors">
            <h2>Edit Existing Sensors</h2>
            <br>
            {% if sensors %}
                <div class="table-wrapper-scroll-y my-custom-scrollbar">
                    <table class="table table-bordered table-striped mb-0">
                        <thead>
                        <tr bgcolor="#e0efdf">
                            <th>SENSOR ID</th>
                            <th>SENSOR NAME</th>
                            <th>SENSOR TYPE</th>
                            <th>UPDATE</th>
                            <th>DELETE</th>
                        </tr>
                        </thead>
                        <tbody>
                {% for sensor in sensors %}
                    <form method="POST" action="update_sensor/{{ sensor.id }}">
                        {% csrf_token %}
                        <tr>
                            <th>{{ sensor.id }}</th>
                            <td><input type="text" name="edit-sensor-name" id="edit-sensor-name"
                             value="{{ sensor.name }}"></td>
                             <td><p>{{ sensor.type_id.name }}</p>
                            <td>
                                <input type="submit" value="Update">
                            </td>
                            <td><a href="delete_sensor/{{ sensor.id }}">Delete</a></td>
                        </tr>
                    </form>
                    {% endfor %}
                    </tbody>
                    </table>
                </div>
            {% else %}
                <h3 style="color:red;"><b> There are no sensors to edit </b></h3>
                <img class=center-image src="{% static 'mercury/technical_difficulties.jpg' %}">
            {% endif%}
        </div> <!-- end view edit sensors-->

        <div id="edit-sensor-types">
            <h2>Edit Existing Sensor Types</h2> <br>
            {% if sensor_types %}
                <h5>Warning: deleting sensor types will delete all sensors of that type.</h5>
                <hr> <br>
                {% for sensor_type in sensor_types %}
                <form method="POST" action="update_type/{{ sensor_type.id }}">
                    {% csrf_token %}
                    <div id = "type-container"> <!-- single div for configuring entire sensor type -->
                        <div class="inline-box">
                            <label for="type-name"> <b>Type Name:</b> </label>
                            <input type="text" id="edit-type-name" name="edit-type-name" value="{{ sensor_type.name }}" required/>
                        </div> <br>

                        <table id="edit-type-table">
                            <thead>
                                <tr>
                                    <th><b> Field Name </b></th>
                                    <th><b> Field Data Type </b></th>
                                    <th><b> Unit </b> </th>
                                </tr>
                            </thead>

                            <tbody>
                                {% for field_name, unit_and_format in sensor_type.format.items %}
                                <tr>
                                    <td> <input type="text" id="edit-field-names" name="edit-field-names" value="{{ field_name }}" required/> </td>

                                    <td>
                                        <select id="edit-data-types" name="edit-data-types"/>
                                        {% if unit_and_format.data_type == "Numeric" %}
                                                <option selected="selected"> Numeric </option>
                                                <option> Character </option>
                                                <option> Boolean </option>
                                        {% else %}
                                            {% if unit_and_format.data_type == "Character" %}
                                                <option> Numeric </option>
                                                <option selected="selected"> Character </option>
                                                <option> Boolean </option>
                                            {% else %}
                                                <option> Numeric </option>
                                                <option> Character </option>
                                                <option selected="selected"> Boolean </option>
                                            {% endif %}
                                        {% endif %}
                                        </select>
                                    </td>

                                    <td> <input type="text" id="edit-units" name="edit-units" value="{{ unit_and_format.unit }}" /> </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table> <br>
                        <input type="submit" value="Update">
                        <a href="delete_type/{{ sensor_type.id }}">Delete</a>
                        <br> <hr> <br>
                    </form>
                {% endfor %}
                </div> <br>
            {% else %}
                <h3 style="color:red;"><b> There are no sensor types to edit </b></h3>
                <img class=center-image src="{% static 'mercury/technical_difficulties.jpg' %}">
            {% endif%}
        </div> <!-- end view edit sensor types-->
        
    </div> <!-- end grafana-base -->
</body>
</html>
